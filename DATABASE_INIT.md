# 数据库初始化说明

## 自动初始化

项目启动后，数据库会自动检查并初始化：

1. **开发环境**：在 `src/lib/prisma.ts` 中，当 `NODE_ENV=development` 时，会自动运行数据库初始化
2. **生产环境**：不会自动运行，需要手动执行

## 手动初始化

### 方法1：使用 npm 脚本
```bash
npm run seed
```

### 方法2：直接运行 TypeScript 文件
```bash
npx tsx prisma/seed.ts
```

## 初始化逻辑

### 数据检查
- 检查 `permission` 表是否有数据
- 检查 `role` 表是否有数据
- 如果两个表都有数据，则跳过初始化

### 创建内容

#### 1. 权限（Permissions）- 中文名称
- **仪表盘**：仪表盘页面访问权限
- **文章管理**：文章管理页面访问权限
- **文章评论**：文章评论管理页面访问权限
- **文章分类**：文章分类管理页面访问权限
- **短剧管理**：短剧管理页面访问权限
- **短剧分类**：短剧分类管理页面访问权限
- **短剧方向**：短剧方向管理页面访问权限
- **短剧评论**：短剧评论管理页面访问权限
- **短剧订单**：短剧订单管理页面访问权限
- **视频管理**：视频管理页面访问权限
- **视频分类**：视频分类管理页面访问权限
- **视频评论**：视频评论管理页面访问权限
- **论坛分类**：论坛板块分类管理页面访问权限
- **论坛板块**：论坛板块管理页面访问权限
- **论坛帖子**：论坛帖子管理页面访问权限
- **论坛评论**：论坛帖子评论管理页面访问权限
- **评论举报**：论坛评论举报管理页面访问权限
- **帖子举报**：论坛帖子举报管理页面访问权限
- **接单管理**：接单平台管理页面访问权限
- **接单分类**：接单分类管理页面访问权限
- **接单评论**：接单评论管理页面访问权限
- **接单订单**：接单订单管理页面访问权限
- **游戏管理**：游戏管理页面访问权限
- **游戏分类**：游戏分类管理页面访问权限
- **游戏题库**：游戏题库管理页面访问权限
- **用户管理**：用户管理页面访问权限
- **管理员管理**：管理员管理页面访问权限
- **角色管理**：角色管理页面访问权限
- **权限管理**：权限管理页面访问权限
- **订单管理**：订单管理页面访问权限
- **网站配置**：网站配置页面访问权限

#### 2. 角色（Roles）- 中文名称
- **超级管理员**：拥有所有权限
- **系统管理员**：管理用户、角色、权限、网站配置
- **内容管理员**：管理文章、短剧、视频相关内容
- **论坛管理员**：专门管理论坛相关内容
- **接单管理员**：管理接单平台相关业务
- **游戏管理员**：管理游戏和题库
- **客服人员**：查看用户信息和订单

#### 3. 角色权限分配

**超级管理员**
- 自动获得所有权限
- 在权限检查时返回 `['SUPER_ADMIN']` 标识
- 前端自动识别并授予所有页面访问权限

**系统管理员**
- 用户管理、管理员管理、角色管理、权限管理、网站配置、仪表盘

**内容管理员**
- 文章管理、短剧管理、视频管理相关权限、仪表盘

**论坛管理员**
- 论坛分类、论坛板块、论坛帖子、论坛评论、举报管理、仪表盘

**接单管理员**
- 接单管理、接单分类、接单评论、接单订单、仪表盘

**游戏管理员**
- 游戏管理、游戏分类、游戏题库、仪表盘

**客服人员**
- 用户管理、订单管理、短剧订单、接单订单、仪表盘

## 文件结构

```
src/
├── lib/
│   ├── prisma.ts          # Prisma 客户端，自动初始化
│   └── init-db.ts         # 数据库初始化逻辑
└── prisma/
    └── seed.ts            # 手动初始化脚本
```

## 注意事项

1. **数据安全**：使用 `upsert` 操作，不会重复创建数据
2. **环境区分**：只在开发环境自动运行
3. **延迟执行**：启动后延迟 1 秒执行，确保数据库连接建立
4. **错误处理**：初始化失败不会影响应用正常运行
5. **中文支持**：所有权限和角色名称都使用中文，便于理解和管理

## 测试

启动项目后，查看控制台输出：
- 如果显示"数据库中已有数据，跳过初始化"，说明数据库已初始化
- 如果显示"数据库为空，开始初始化权限和角色..."，说明正在初始化
- 如果显示"数据库初始化完成！"，说明初始化成功

## 权限资源标识

权限系统使用英文资源标识符（resource），便于程序识别：
- `DASHBOARD` - 仪表盘
- `ARTICLE` - 文章管理
- `VIDEO` - 视频管理
- `FORUM_POST` - 论坛帖子
- `TASK` - 接单管理
- `GAME` - 游戏管理
- 等等... 