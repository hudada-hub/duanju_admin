# 短剧批量创建脚本

这个脚本可以扫描指定目录下的所有文件夹，并批量调用API创建短剧。

## 功能特性

- 🔍 智能扫描目录结构
- 📝 自动解析文件夹名，提取短剧信息
- 🎭 识别演员信息（支持＆和&分隔符）
- 📊 统计集数信息
- 🔄 自动重试机制
- 📋 生成详细报告
- ⏱️ 请求间隔控制，避免API限流

## 文件夹名解析规则

脚本支持以下格式的文件夹名：

```
格式: [前缀]-[短剧名]（[集数]集）[演员1]＆[演员2]
示例: W-我在七零当机长太太（80集）朱傲宇＆蔡淼燕
```

### 解析结果

- **前缀**: 自动移除（如 W-、V- 等）
- **短剧名**: 提取为标题
- **集数**: 识别括号中的数字+集
- **演员**: 识别＆或&分隔的演员名单

## 安装依赖

```bash
npm install axios
```

## 使用方法

### 1. 配置脚本

编辑 `batch-create-shorts.js` 文件中的 `CONFIG` 对象：

```javascript
const CONFIG = {
  API_BASE_URL: 'http://localhost:3200',        // API基础地址
  API_ENDPOINT: '/api/shorts',                  // API端点
  AUTHORIZATION_TOKEN: 'Bearer your-token',     // 认证令牌
  VIDEO_PATH: 'E:\\video',                      // 扫描路径
  DEFAULT_COVER_URL: '封面图片URL',              // 默认封面
  DEFAULT_CATEGORY_ID: 3,                       // 默认分类ID
  DEFAULT_DIRECTION_ID: 1,                      // 默认方向ID
  DEFAULT_STATUS: 'COMPLETED',                  // 默认状态
  DELAY_BETWEEN_REQUESTS: 1000,                // 请求间隔（毫秒）
  MAX_RETRIES: 3                               // 最大重试次数
};
```

### 2. 运行脚本

```bash
# 运行主脚本
node batch-create-shorts.js

# 测试解析功能
node test-parse.js
```

## 脚本工作流程

1. **扫描目录**: 扫描指定路径下的所有文件夹
2. **识别视频**: 检查每个文件夹是否包含视频文件
3. **解析名称**: 智能解析文件夹名，提取短剧信息
4. **生成数据**: 根据解析结果生成短剧数据
5. **调用API**: 批量调用创建短剧接口
6. **生成报告**: 输出处理结果和详细报告

## 输出示例

```
🚀 短剧批量创建脚本启动
📁 扫描路径: E:\video
🌐 API地址: http://localhost:3200/api/shorts

开始扫描目录: E:\video
找到 5 个文件夹

扫描结果:
  ✅ W-我在七零当机长太太（80集）朱傲宇＆蔡淼燕
     标题: 我在七零当机长太太
     集数: 80集
     演员: 朱傲宇、蔡淼燕
     视频文件: 80个

  ✅ V-都市之最强医仙（120集）张三＆李四
     标题: 都市之最强医仙
     集数: 120集
     演员: 张三、李四
     视频文件: 120个

开始批量创建短剧...
总共需要处理 2 个文件夹

[1/2] 处理文件夹: W-我在七零当机长太太（80集）朱傲宇＆蔡淼燕
正在创建短剧: 我在七零当机长太太
✅ 短剧创建成功: 我在七零当机长太太 (ID: 123)

[2/2] 处理文件夹: V-都市之最强医仙（120集）张三＆李四
正在创建短剧: 都市之最强医仙
✅ 短剧创建成功: 都市之最强医仙 (ID: 124)

============================================================
批量创建短剧完成！
============================================================
总计: 2 个文件夹
成功: 2 个
失败: 0 个
跳过: 0 个

详细报告已保存到: batch-create-shorts-report-1234567890.json
```

## 注意事项

1. **API认证**: 确保提供的认证令牌有效且未过期
2. **网络连接**: 确保能够访问API服务器
3. **文件权限**: 确保有读取目标目录的权限
4. **API限流**: 适当调整请求间隔，避免触发API限流
5. **数据备份**: 建议在运行前备份重要数据

## 错误处理

脚本包含完善的错误处理机制：

- **网络错误**: 自动重试（最多3次）
- **API错误**: 显示详细的错误信息
- **解析错误**: 使用原始文件夹名作为备选
- **文件错误**: 跳过无法访问的文件夹

## 自定义配置

你可以根据需要修改以下部分：

- **视频文件扩展名**: 在 `checkForVideoFiles` 函数中修改
- **标题生成规则**: 在 `generateTitle` 函数中自定义
- **描述生成模板**: 在 `generateDescription` 函数中调整
- **演员信息处理**: 在 `generateActors` 函数中自定义

## 支持的文件格式

- 视频: .mp4, .avi, .mkv, .mov, .wmv, .flv, .webm
- 图片: .jpg, .jpeg, .png, .gif, .webp

## 报告文件

脚本运行完成后会生成详细的JSON报告文件，包含：

- 处理总数和成功/失败数量
- 每个文件夹的详细处理结果
- 成功创建的短剧ID和响应数据
- 失败原因和错误信息

这个报告文件可以用于后续的数据分析和问题排查。 